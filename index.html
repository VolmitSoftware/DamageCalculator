<!doctype html>
<html lang="en">
<head>
    <title>Volmit Software - Damage calculator</title>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.0.0-beta3/css/bootstrap.min.css"
          integrity="sha512-N415hCJJdJx+1UBfULt+i+ihvOn42V/kOjOpp1UTh4CZ70Hx5bDlKryWaqEKfY/8EYOu/C2MuyaluJryK1Lb5Q=="
          crossorigin="anonymous"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
          integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w=="
          crossorigin="anonymous"/>
    <link rel="stylesheet" href="dist/css/beautify.css">
</head>
<body>
<div class="container">
    <div class="jumbotron mb-4">
        <h1 class="display-4">Volmit Software - Damage calculator</h1>
        <p class="lead">Simply calculate the damage values for your texture pack.</p>
        <hr class="my-4">
        <p>You indicate which item you want to use and where the models are for each damage value. This tool then
            creates the .json file for you.</p>
    </div>
    <form id="calculatorForm">
        <div class="mb-3 w-50">
            <label for="item">The item to use:</label>
            <select class="form-control" id="item" name="item" required>
                <option selected>Select an item...</option>
                <option value="leather_boots">Leather Boots</option>
            </select>
        </div>
        <div id="formItems" style="display: none;">
            <div class="mb-3 w-50">
                <label for="itemcount">The amount of models:</label>
                <div class="input-group">
                    <button type="button" class="btn btn-outline-secondary btn-number" disabled
                            data-type="minus" data-field="quant[1]">
                        <span class="fas fa-minus"></span>
                    </button>
                    <input type="text" id="itemcount" name="quant[1]" class="form-control input-number" value="1" min="1"
                           max="2" readonly>
                    <button type="button" class="btn btn-outline-secondary btn-number" data-type="plus"
                            data-field="quant[1]">
                        <span class="fas fa-plus"></span>
                    </button>
                </div>
            </div>
            <div id="items">
                <div class="mb-3 w-50">
                    <label for="item1">Model for damage 1:</label>
                    <input type="text" class="form-control" id="item1" name="item1" placeholder="cars/blue_car" required>
                </div>
            </div>
            <button type="submit" class="btn btn-primary">Calculate</button>
        </div>
    </form>
    <hr class="my-4">
    <h6>Output JSON:</h6>
    <pre id="content" class="mb-3 w-50">Fill in the form above to get an output.</pre>
    <button id="copyButton" class="btn btn-primary mb-3 mr-3">Copy</button>
    <a id="downloadButton" class="btn btn-secondary mb-3" href="#">Download</a>
</div>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"
        integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ=="
        crossorigin="anonymous"></script>
<script type="application/javascript" src="dist/js/bootstrap-plusmin.js"></script>
<script type="application/javascript" src="dist/js/calculator.js"></script>
<script type="application/javascript" src="dist/js/beautify.js"></script>
<script>
    $(document).ready(function () {
        const form = document.getElementById("calculatorForm");
        const output = document.getElementById("content");

        const copybutton = document.getElementById("copyButton");
        const downloadbutton = document.getElementById("downloadButton");

        $('#item').change(function () {
            if (this.value !== "") {
                $("#formItems").show();

                const max = itemDamages[this.value];
                $("#itemcount").prop('max', max);
            } else {
                $("#formItems").hide();
            }
        });

        $('.btn-number').click(function (e) {
            e.preventDefault();

            const fieldName = $(this).attr('data-field');
            const type = $(this).attr('data-type');
            const input = $("input[name='" + fieldName + "']");
            const currentVal = parseInt(input.val());

            if (type === 'minus') {
                $("#iteminput" + (currentVal + 1)).remove();
            } else if (type === 'plus') {
                $("#items").append("<div id=\"iteminput" + currentVal + "\" class=\"mb-3 w-50\"><label for=\"item" + currentVal + "\">Model for damage " + currentVal + ":</label><input type=\"text\" class=\"form-control\" id=\"item" + currentVal + "\" name=\"item" + currentVal + "\" placeholder=\"cars/" + randomModel() + "\" required></div>");
            }
        });

        form.addEventListener("submit", function (e) {
            if (e.preventDefault) e.preventDefault();

            const item = document.getElementById('item').value;

            const fieldName = $('.btn-number').attr('data-field');
            const input = $("input[name='" + fieldName + "']");
            const currentVal = parseInt(input.val());

            const models = [];
            for (let i = 0; i < currentVal; i++) {
                models[i] = document.getElementById("item" + (i + 1)).value;
            }
            const json = toJSON(item, models);

            output.innerHTML = syntaxHighlight(json);

            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(json);
            downloadbutton.setAttribute("href", dataStr);
            downloadbutton.setAttribute("download", item + ".json");

            return false;
        });

        copybutton.addEventListener("click", function () {
            const copyText = output.textContent;
            const textArea = document.createElement("textarea");
            textArea.textContent = copyText;
            document.body.append(textArea);
            textArea.select();
            document.execCommand("copy");
            textArea.remove();
        });

        function randomModel() {
            const months = ["red_car", "blue_car", "green_car", "orange_car", "blue_bicycle", "red_bicycle", "green_bicycle", "orange_bicycle"];
            return months[Math.floor(Math.random() * months.length)];
        }
    });
</script>
</html>